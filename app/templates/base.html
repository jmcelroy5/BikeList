<html>
    <head>
          <meta charset="utf-8">
          <meta http-equiv="X-UA-Compatible" content="IE=edge">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <meta name="description" content="">
          <meta name="author" content="">

          <title> {% block title %} {% endblock %} BikeList</title>

            <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

            {% block scripts %} 
            <!-- Page-specific scripts will be added here -->
            {% endblock %}

            <!-- Stylesheets -->
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
            <link rel="stylesheet" href="{{ url_for('static',filename='css/styles.css') }}">
           <!--  <link href='http://fonts.googleapis.com/css?family=Concert+One' rel='stylesheet' type='text/css'> -->
            <link href='http://fonts.googleapis.com/css?family=Exo+2' rel='stylesheet' type='text/css'>
            <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
           
    <style>

    #header-search{
      display:inline-block;
      size: 40px;
      margin-top: 41px;
    }
    #bikelist-header{
      padding: 7px 20px;
      background: #e4e4e4;
      border-bottom: 1px solid;
      font-color: white;
      height:50px;
    }

    #maindiv{
      margin-top:55px;
    }

    .navbar-header{
      margin-top:10px;
    }

    #logo{
      font-size: 40px;
      margin-left: -80px;
      margin-top: -15px;
      position: absolute;
    }

    .nav li{
      margin-left: 16px;
    }

    .navbar-nav>li>.dropdown-menu{
      margin-top: 0px
    }

    #btn-list-bike{
      margin-top:10px;
      margin-left:-23px;
    }

    </style>


    </head>

    <body>

      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" id="logo" href="/">
              BikeList</span>
              <!-- <img alt="brand" src="..." > -->
            </a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
              
              {% if g.logged_in %}
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><h4><span class="caret"></span> {{g.name}} </h4></a>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="/mylistings">My Listings</a></li>
                  <li class="divider"></li>
                  <li><a href="/favoritebikes">My Favorite Bikes</a></li>
                  <li class="divider"></li>
                  <li><a href="/logout">Logout</a></li>
                  <li class="divider"></li>
                </ul>
              </li>

              {% else %}
              <li>
                <a data-toggle="modal" data-target="#login-modal"><h4>Login</h4></a>
              </li>

              <!-- Login Modal -->
              <div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                      <h4 class="modal-title" id="myModalLabel">Login</h4>
                    </div>
                    <div class="modal-body">
                      <a href="/facebook_login"><img src="http://i.stack.imgur.com/pZzc4.png"></a>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                  </div>
                </div>
              </div>

              {% endif %}

              <li>
                <form class="navbar-form navbar-right" action="/sell">
                  <button type="button" id="btn-list-bike" class="btn btn-default btn-md" data-toggle="modal" data-target="#list-bike-modal">List Your Bike</button>
                </form>
              </li>
            <!-- List Your Bike Modal -->
            <div class="modal fade" id="list-bike-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h3 class="modal-title" id="myModalLabel">List Your Bike</h3>
                  </div>
                  <div id="modal-body" class="modal-body">
                      <form id="get-serial">
                        <h4>Enter your bike serial number to get started.</h4><br>
                        <input class="form-control" id="bike-serial" type="text" name="serial" placeholder="Bike Serial Number"></input><br><br>
                        <strong>Note:</strong><br><br>
                        Your bike must already be registered at <a href="http://www.bikeindex.org/"> BikeIndex.org </a> before you can sell it on BikeList. Make sure you have filled out as much information about your bike as possible on your BikeIndex registration. <br><br>
                      </form>
                          <div id="verify-bike" class="bike-info">
                            <img id="bike-pic"><br><br>
                            <div id='confirm'>
                              <form>
                                <!-- <h2> Is this the bike you want to sell?</h2> -->
                                <button class="btn btn-primary" id="Yes">Sell this bike</button>
                                <button class="btn btn-default" id="No">That's not my bike</button>
                              </form> 
                            </div>
                          </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button id="submit-serial" class="btn btn-primary">Find Your Bike</button>
                  </div>
                </div>
              </div>
            </div>


            </ul>
          </div>
        </div>
      </nav>

    <div id="maindiv" class="container-fluid">

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}

            <!-- class="flashes"--> 
            {{message}}

          {% endfor %}
          {% endif %}
          {% endwith %}

          {% block content %} 
          <!-- Child template will be inserted here -->
          {% endblock %}
      </div>



        <script>
        (function() {

        $("#submit-serial").on("click",function(e){
          var serial = $("#bike-serial").val();
          $("#get-serial").hide();
          $("#submit-serial").hide();
          getBike(serial);
        });

        function getBike(serial) {

          $.get("/fetchbike", {serial: serial}, function(data){

            // check to make sure we got one bike back
            if (data["response"]["bikes"].length === 1){
              var bike = data["response"]["bikes"][0];
              console.log(bike);
            }

            // check if bike is stolen
            var stolen = bike["stolen"];
            if (stolen===true){
              $("#modal-body").html("<img src='https://bikeindex.org/assets/home/hacksaw-man.svg'>");
              $("#modal-body").prepend("<h1>That bike is stolen!</h1>").css("color","red").css("text-align","center");
            }

            // if bike is not stolen
            if (bike && stolen===false){
              // display bike photo and specs for verification
              $("#verify-bike").show();
              $("#bike-pic").attr('src', bike["photo"]);

              // add click listeners to confirmation buttons
              $("#Yes").on("click",function(e){
                e.preventDefault();
                postBike(bike);
              });

              $("#No").on("click", function(e){
                e.preventDefault();
                $("#get-serial > h4").text("Make sure you entered your serial number correctly.").css("color","red")
                $("#verify-bike").hide();
                $("#get-serial").show();
                $(".modal-footer").show();
              });
            }
          });
        }

        function postBike(bike){
          // Turn bike object into JSON string to pass to python
          var bikedata = JSON.stringify(bike);

          $.post("/addbike", {bike: bikedata}, function(){
            $("#verify-bike").hide();
            $("#get-serial").hide();
            $("$submit-serial").show();
            $(".modal-body").prepend("<h4> Your listing has been created! </h4>");
            $("#submit-serial").replaceWith("<button id='continue-to-form' class='btn btn-primary'>Continue</button>");
            $("#continue-to-form").on('click', function(){
              window.location.replace("/list");
            });
          });
        }

        })();
        </script>

    </body>
</html>