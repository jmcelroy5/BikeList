{% extends 'base.html' %}

{% block scripts %}
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />
{% endblock %}

{% block content %}
<style>

	.bike-pic{
		width: 400px;
		float: left;
		margin: 0px;
		border-radius:5px;
	}

	img.seller-contact{
		width: 100px;
		margin-bottom:60px;
		margin-left: 0;
		margin-right: 20px;
		float: left;
	}

	#seller-text{
		margin-bottom:15px;
	}

	#price{
		color: #3887be;
		/*margin-bottom:10px;*/
	}

	#bikelocation{
		width: 430px;
		float:left;
		top:60px;
		left:0;
		bottom:0;
	    position: fixed;
	    margin-bottom:0px;
	    overflow:hidden;
  	}

	#search-panel{
		float:right;
		width: 746px;
		margin-left: 430px;
		margin-top: -66;
		position: absolute;
	}

	#listing-form{
		margin-top:50px;
	}

	.attr-list{
		display:inline-block;
		width:60%;
	}

	.contact-seller{

	}

</style>
	<div id="search-panel">	
		<h1> {{ bike.title }}</h1>
		<span id="price"><h3>${{ listing.asking_price }}.00</h3></span>
		<img class="bike-pic" src={{ bike.photo }}><br><br>

		<ul class="attr-list">
			<h3>Specs</h3>
			<li id="serial"><span class="attr-title">Serial</span>{{ bike.serial }}</li>
			<li id="size"><span class="attr-title">Size</span>{{ bike.size }}</li>
			<li id="manufacturer"><span class="attr-title">Manufacturer</span>{{ bike.manufacturer }}</li>
			<li id="model"><span class="attr-title">Model</span> {{ bike.frame_model }} </li>
			<li id="year"><span class="attr-title">Year</span> {{ bike.year }} </li>
			<li id="material"><span class="attr-title">Frame Material</span> {{ bike.frame_material }}</li>
			<li id="handlebar"><span class="attr-title">Handlebar type</span> {{ bike.handlebar_type }}</li>
			<li id="wheel"><span class="attr-title">Wheel diameter</span> {{ bike.rear_wheel_size }}</li>
			<li id="color"><span class="attr-title">Primary colors</span>{{ bike.frame_colors }}</li>
		</ul>

		<h3>A few more words</h3>
		<p> {{ listing.additional_text }}</p>
		<a href="{{bike.bikeindex_url}}">See it on BikeIndex</a>

		<div id="bikeLocation">
			<!-- Map will go here -->
		</div>
		

			<h3>Contact seller</h3>
			{% if g.logged_in %}
				<a href="{{ user.facebook_url }}"><img class="seller-contact" src="{{user.avatar}}"></a>
				<br>
				<h4> {{ user.first_name }} </h4>
				<p>{{ user.email }}</p>
			{% else %}
				<p> You must be <a href="/login">logged in</a> to see seller's contact information.</p>
			{% endif %}
		</div>
		<div style="clear:both"/>

		</div>

	</div>


	
<script>
//display a little mapbox with listing location

	var bikeLocationMap = function(){
		//Connect to MapBox API
		L.mapbox.accessToken = "pk.eyJ1Ijoiam1jZWxyb3kiLCJhIjoiVVg5eHZldyJ9.FFzKtamuKHb_8_b_6fAOFg";
		// Initiate map 
		map = L.mapbox.map('bikeLocation', 'examples.map-i86nkdio');


		// get coordinates of listing
		var longitude = {{ listing.longitude }};
		var latitude = {{ listing.latitude }};
		console.log(longitude, latitude);
		// set starting view/zoom(SF)
		map.setView([latitude, longitude], 12);

		// Create new marker/layer
		newMarker = L.mapbox.featureLayer(); 

		// Marker location and properties
		var geoJson = [{
			type: 'Feature',
				"geometry": { 
					"type": "Point", 
					"coordinates": [longitude, latitude]
				},
				"properties": {
					'marker-size': 'large',
		        	'marker-color':  '#00529f',
		        	'marker-symbol': 'bicycle'
				}
			}];

		// Set geoJSON
		newMarker.setGeoJSON(geoJson);
		newMarker.addTo(map);
	}

	$(document).ready(function(){
		bikeLocationMap();
	});



</script>

{% endblock %}